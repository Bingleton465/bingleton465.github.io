<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Car Crash Physics Demo</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; background: #fafafa; }
  </style>
</head>
<body>
  <!-- Matter.js Physics Engine -->
  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
  <script>
    // module aliases
    const { Engine, Render, Runner, World, Bodies, Body, Constraint, Events } = Matter;

    // create engine and world
    const engine = Engine.create();
    const world = engine.world;

    // create renderer
    const width = window.innerWidth;
    const height = window.innerHeight;
    const render = Render.create({
      element: document.body,
      engine: engine,
      options: {
        width: width,
        height: height,
        wireframes: false,
        background: '#ffffff'
      }
    });
    Render.run(render);
    Runner.run(Runner.create(), engine);

    // ground
    const ground = Bodies.rectangle(width / 2, height - 50, width, 100, {
      isStatic: true,
      render: { fillStyle: '#060a19' }
    });
    World.add(world, ground);

    // ramp
    const ramp = Bodies.rectangle(600, height - 150, 300, 20, {
      isStatic: true,
      angle: -0.3,
      render: { fillStyle: '#4a4a4a' }
    });
    World.add(world, ramp);

    // obstacle stack
    const stack = [];
    for (let i = 0; i < 5; i++) {
      stack.push(
        Bodies.rectangle(1100, height - 70 - i * 40, 50, 50, {
          restitution: 0.4,
          friction: 0.8
        })
      );
    }
    World.add(world, stack);

    // car chassis
    const carWidth = 120;
    const carHeight = 30;
    const car = Bodies.rectangle(200, height - 100, carWidth, carHeight, {
      density: 0.0002,
      friction: 0.1,
      restitution: 0.1,
      render: { fillStyle: '#ff0000' }
    });

    // wheels
    const wheel1 = Bodies.circle(160, height - 70, 20, {
      density: 0.0005,
      friction: 0.8,
      restitution: 0.1,
      render: { fillStyle: '#000000' }
    });
    const wheel2 = Bodies.circle(240, height - 70, 20, {
      density: 0.0005,
      friction: 0.8,
      restitution: 0.1,
      render: { fillStyle: '#000000' }
    });

    // constraints (axles)
    const axle1 = Constraint.create({
      bodyA: car,
      pointA: { x: -40, y: 15 },
      bodyB: wheel1,
      stiffness: 0.5,
      length: 0
    });
    const axle2 = Constraint.create({
      bodyA: car,
      pointA: { x: 40, y: 15 },
      bodyB: wheel2,
      stiffness: 0.5,
      length: 0
    });

    World.add(world, [car, wheel1, wheel2, axle1, axle2]);

    // controls
    const keys = { left: false, right: false };
    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowRight') keys.right = true;
      if (e.key === 'ArrowLeft') keys.left = true;
    });
    document.addEventListener('keyup', e => {
      if (e.key === 'ArrowRight') keys.right = false;
      if (e.key === 'ArrowLeft') keys.left = false;
    });

    // apply forces for movement
    Events.on(engine, 'beforeUpdate', () => {
      if (keys.right) {
        Body.applyForce(wheel1, wheel1.position, { x: 0.03, y: 0 });
        Body.applyForce(wheel2, wheel2.position, { x: 0.03, y: 0 });
      }
      if (keys.left) {
        Body.applyForce(wheel1, wheel1.position, { x: -0.03, y: 0 });
        Body.applyForce(wheel2, wheel2.position, { x: -0.03, y: 0 });
      }
    });
  </script>
</body>
</html>
